### 渲染阶段

`Renderer`工作的阶段被称为`commit`阶段。

在`render阶段`，发生更新的组件对应的 Fiber 节点会被打上`effectTag`。这些 Fiber 节点在`render阶段`的“归”阶段会形成一条链表，在`commit阶段`会遍历这条链表执行对应的操作，这个操作被称为`mutation`。对于`HostComponent`来说，`mutation`意味着 DOM 节点的增、删、改

整个`commit阶段`的过程可以分为三个子阶段

- `before mutation`阶段，执行 DOM 操作前
- `mutation`阶段，执行 DOM 操作
- `layout`阶段，执行 DOM 操作后

`commit阶段`开始于`commitRoot`这个方法

---

### 源码

源码目录：`react/src/react-reconciler/src/ReactFiberWorkLoop.old.js`  17.0.1

① `commit阶段`开始于`commitRoot`方法，`commitRoot`方法内部就是调用`commitRootImpl`

```js
function commitRoot(root) {
  const renderPriorityLevel = getCurrentPriorityLevel();
  runWithPriority(
    ImmediateSchedulerPriority,
    commitRootImpl.bind(null, root, renderPriorityLevel)
  );
  return null;
}
```

---

② `commitRootImpl`方法内部就是执行了`commit阶段的三个流程`

```js
function commitRootImpl(root, renderPriorityLevel) {
    // ...
    // 1.0 commit  beforeMutation阶段执行的工作
    do {
      if (__DEV__) {} else {
        try {
          commitBeforeMutationEffects();
        } catch (error) {
        }
      }
    } while (nextEffect !== null);

    // 2.0 commit  mutation阶段执行的工作
    nextEffect = firstEffect;
    do {
      if (__DEV__) {}
      else {
        try {
          commitMutationEffects(root, renderPriorityLevel);
        } catch (error) {
        }
      }
    } while (nextEffect !== null);

    if (shouldFireAfterActiveInstanceBlur) {
      afterActiveInstanceBlur();
    }
    resetAfterCommit(root.containerInfo);

    // 3.0 commit  layout阶段执行的工作
    do {
      if (__DEV__) {} else {
        try {
          commitLayoutEffects(root, lanes);
        } catch (error) {
        }
      }
    } while (nextEffect !== null);
```
