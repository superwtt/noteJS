### React生命周期

网上看到很多关于生命周期的文章，林林总总，不如自己总结一下。<br/>
React的生命周期，分为三个阶段，挂载、更新、卸载。<br/>
组件第一次挂载走的是挂载阶段，之后走的都是更新阶段。

---

#### 挂载阶段

当组件实例被创建并且插入DOM时，其生命周期调用顺序如下：
+ <a href="#1">constructor()</a>
+ <a href="#2">static getDerivedStateFromProps(nextProps,prevState)</a>
+ <a href="#3">render()</a>
+ <a href="#4">componentDidMount()</a>

---

#### 更新阶段

当组件的props或者state发生变化时会触发更新，组件更新的生命周期调用顺序如下：
+ <a href="#2">static getDerivedStateFromProps(nextProps,prevState)</a>
+ <a href="#5">shouldComponentUpdate()</a>
+ <a href="#3">render()</a>
+ <a href="#6">getSnapshotBeforeUpdate()</a>
+ <a href="#7">componentDidUpdate()</a>

---

#### 卸载阶段

当组件从DOM中移除的时候会调用的阶段
+ <a href="#8">componentWillUnmount()</a>

---

#### 各个生命周期定义

<a name="1">constructor()</a>

组件挂载之前，会调用它的构造函数。React中，构造函数仅仅用于：
+ 给state初始化内部状态
+ 给事件函数绑定this

---

<a name="2">static getDerivedStateFromProps(nextProps,prevState)</a>

将传入的props映射到state上面，是一个静态方法，父组件传入的newProps和当前组件prevState进行比较，如果需要更新state，则返回需要更新的state；如果不需要更新state，则返回null。

注意点：
+ 会在调用render()方法之前调用，并在在初始挂载和后续更新时都会被调用（这个生命周期适合state完全取决于props）
+ 不要在子组件里直接复制props到state上，而是去实现一个受控组件，在父组件里管理state，直接控制父组件的值（设计组件时，要确定这个组件是受控组件还是非受控组件） 
+ 尽量可以不用使用这个生命周期

使用场景：
+ 完全受控组件：无条件从props中更新state（这个场景中我们完全没必要使用这个生命周期，父组件直接控制子组件的props值就行了）
+ 半受控组件：子从props中更新state获取到数据，子组件内部又需要触发一些方法对state进行修改，这时候就会发现数据并不会改变（解决方法是保存之前传入的props与现在的props作对比）

---

<a name="3">render()</a>

当render()被调用时，它会检查this.props和this.state的变化并返回React元素或其他元素

---

<a name="4">componentDidMount()</a>

在render()方法之后执行，组件挂载后（插入DOM树中）立即调用。可以在这里调用网络请求，返回数据setState之后组件会重新渲染。

注意点：
+ 这个方法只会执行一次，即初次render()执行之后立即执行。后续render()执行后会执行componentDidUpdate

---

<a name="5">shouldComponentUpdate()</a>

主要用于性能优化，部分更新。React中，setState之后state发生变化，组件会进入重新渲染的流程，在这里return false会阻止组件的重新渲染。

注意点：
+ 不建议在shouldComponentUpdate中进行深层比较或者使用JSON.stringify()，这样非常影响效率并且损害新能

---

<a name="6">getSnapshotBeforeUpdate()</a>

在最终的render之前被调用，用来替代componentWillUpdate

---

<a name="7">componentDidUpdate(prevProps,prevState)</a>

组件更新完毕后，react只会在第一次初始化成功会进入到componentDidMount，之后每次重新渲染后都会进入这个生命周期

---

<a name="7">componentWillUnmount</a>

当组件从DOM中移除时会调用这个方法，会在组件卸载以及销毁之前直接调用，可在此方法中执行必要的清理操作。

---

#### 弃用的生命周期

+ componentWillMount
+ componentWillReceiveProps
+ componentWillUpdate

---

#### 参考链接
[使用场景解析](https://juejin.im/post/6844903760305602568)<br />
[官网](https://react.docschina.org/docs/react-component.html#static-getderivedstatefromprops)<br />
[为什么弃用这些生命周期](https://juejin.im/post/6844903679418433550)