### 前端接口的缓存与更新

项目开发过程中，常常遇到数据列表的请求，当用户进行切换、返回、下一页等操作时，我们自然而然的是刷新页面请求数据。但是，对于短时间内不会变化的数据列表，是没有重复一直刷新的必要的

#### 场景再现

![](https://oscimg.oschina.net/oscnet/up-297ded38b6cc0600d6856d1a008810c2adb.png)

如图：<br/>
1. 底部菜单栏分为“进行中”，“历史任务”两个tab，两个请求
2. 顶部二级菜单栏分为“最新任务”，“马上过期”，两个请求
3. 当用户频繁切换这四个tab栏时，将会不停的发送请求，界面会一直在loading和数据展示中闪烁切换
4. 这四个tab栏中的数据，短时间内是不会变化的，而是周期性变化
---

#### 解决方法
1. store存储数据
2. 接口请求复用

---

#### 实践
1. store中心存储数据，每次ajax请求之前先去store获取数据，如果有直接返回，如果没有就请求接口获取数据列表
```javascript
// ajax请求部分
http.getData().then(data=>{
   userList = data; // 赋值
})
// 数据存储
import fetch from "fetch";

const EXPIRE_TIME = 60000; // 设置过期时间为1分钟

class StoreDataCenter{
    getData(){
        const isDataOverTime = StoreDataCenter.isOverTime();
        return isDataOverTime?null:StoreDataCenter.getData()  // 过期了 返回Null,没过期 返回数据
    }
    static isOverTime(){
       const data = storeDataCenter.getData();
       if(!data) return true; // 没有数据 超时

       const currentTime = new Date().getTime(); // 当前时间戳

       const overTime = (currentTime-cacheData.expire)/1000; // 获取当前时间与存储数据时间之差
       if(overTime>EXPIRE_TIME){
          StoreDataCenter.deleteData()
          return true
       }
       return false
    }
    static saveData(res){
      // 缓存数据 并且将当前时间戳存入 方便之后判断数据是否过期
      let data = {
        expire: new Date().getTime(),
        data: response.data
      }
    }
    static deleteData(){
      // 删除数据缓存
    }
}
// http层
let data = StoreDataCenetr.getData();
if(!data){
    fetch.get({
        url:"/getData"
    }).then(res=>{
        storeDataCenter.storeData()
        return storeDataCenter.getData()
    })
}
return data
```
+ 优点：直接有效的解决了频繁请求服务端的问题，并且代码简单，容易理解和实现
+ 缺点：对于数据列表会频繁改变的需求，这个方法就不能适用了

#### 参考链接
https://www.zhihu.com/question/40035517
https://my.oschina.net/wsafight/blog/3040140
https://www.wodecun.com/blog/7931.html